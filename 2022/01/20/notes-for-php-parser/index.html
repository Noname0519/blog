<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Code for fun, Hack for world">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        notes for php-parser - undefined
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 6.0.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Code for fun, Hack for world </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/images/avatar.jpg" />
        </div>
        <div class="name">
            <i>Noname</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#notes-for-php-parser"><span class="toc-text">notes for php-parser</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basic-operation"><span class="toc-text">basic operation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-traversation"><span class="toc-text">Node traversation</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Code for fun, Hack for world </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        notes for php-parser
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2022-01-20 15:14:04</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#web" title="web">web</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h1 id="notes-for-php-parser"><a href="#notes-for-php-parser" class="headerlink" title="notes for php-parser"></a>notes for php-parser</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>最近根据需求，学习php代码的静态分析，希望能提取php代码的AST，采用php-parser库</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nikic/PHP-Parser">https://github.com/nikic/PHP-Parser</a></p>
<p>所以这篇其实应该叫做<code>结合php-parser学习污点分析</code></p>
<p>且该篇基本不对ast转换为原本代码做过多的研究</p>
<h2 id="basic-operation"><a href="#basic-operation" class="headerlink" title="basic operation"></a>basic operation</h2><p>根据文档，编写小demo记录所需的用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">// 加载</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&quot;vendor/autoload.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用命名空间</span></span><br><span class="line">	<span class="keyword">use</span> <span class="title">PhpParser</span>\<span class="title">ParserFactory</span>;</span><br><span class="line">	<span class="keyword">use</span> <span class="title">PhpParser</span>\<span class="title">NodeDumper</span>;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">// 要解析的代码</span></span><br><span class="line">	<span class="variable">$code</span> = file_get_contents(<span class="string">&#x27;test/1.php&#x27;</span>);</span><br><span class="line">	<span class="comment">// <span class="meta">&lt;?php</span> @assert($_POST[&#x27;shell&#x27;]);<span class="meta">?&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 实例化 将代码解析为php7</span></span><br><span class="line">	<span class="variable">$parser</span> = (<span class="keyword">new</span> ParserFactory)-&gt;create(ParserFactory :: PREFER_PHP7);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="variable">$ast</span> = <span class="variable">$parser</span>-&gt;parse(<span class="variable">$code</span>);</span><br><span class="line">		<span class="comment">// dump输出</span></span><br><span class="line">		<span class="variable">$nodeDump</span>= <span class="keyword">new</span> NodeDumper();</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$nodeDump</span>-&gt;dump(<span class="variable">$ast</span>);</span><br><span class="line">	&#125;<span class="keyword">catch</span>(<span class="built_in">Error</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Parse Error: &#x27;</span>, <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    0: Stmt_Expression(</span><br><span class="line">        expr: Expr_ErrorSuppress(</span><br><span class="line">            expr: Expr_FuncCall(</span><br><span class="line">                name: Name(</span><br><span class="line">                    parts: array(</span><br><span class="line">                        0: assert</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                args: array(</span><br><span class="line">                    0: Arg(</span><br><span class="line">                        name: null</span><br><span class="line">                        value: Expr_ArrayDimFetch(</span><br><span class="line">                            var: Expr_Variable(</span><br><span class="line">                                name: _POST</span><br><span class="line">                            )</span><br><span class="line">                            dim: Scalar_String(</span><br><span class="line">                                value: shell</span><br><span class="line">                            )</span><br><span class="line">                        )</span><br><span class="line">                        byRef: false</span><br><span class="line">                        unpack: false</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这里包含了<code>Stmt_Expression</code>节点，对应的空间为<code>PhpParser\Node\Stmt\Function_</code></p>
<p>这里做了三种类别：</p>
<ul>
<li><code>PhpParser\Node\Stmt</code> 语句节点，不返回值，且不能出现在一个表达式中，例如类定义<code>class A</code></li>
<li><code>PhpParser\Node\Expr</code>表达式节点，有返回值的语言结构，如变量<code>$a</code>、函数<code>func()</code></li>
<li><code>PhpParser\Node\Scalar</code>标量节点，如<code>string</code> <code>__FILE__</code></li>
<li>其他节点如<code>PhpParser\Node\Name</code>、<code>PhpParser\Node\Arg</code></li>
</ul>
<p>所以上述一句话木马中的结构含有一个函数调用，所以仅有一个<code>Stmt_Expression</code>节点</p>
<p>所以也可以针对这棵语法树对节点部分做分析</p>
<p>加一个循环来输出看内部结构</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$ast</span> <span class="keyword">as</span> <span class="variable">$item</span>)&#123;</span><br><span class="line">			var_dump(<span class="variable">$item</span>,<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到更具体的类型和格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">object(PhpParser\Node\Stmt\Expression)#1185 (2) &#123;</span><br><span class="line">  [&quot;expr&quot;]=&gt;</span><br><span class="line">  object(PhpParser\Node\Expr\ErrorSuppress)#1184 (2) &#123;</span><br><span class="line">    [&quot;expr&quot;]=&gt;</span><br><span class="line">    object(PhpParser\Node\Expr\FuncCall)#1183 (3) &#123;</span><br><span class="line">      [&quot;name&quot;]=&gt;</span><br><span class="line">      object(PhpParser\Node\Name)#1178 (2) &#123;</span><br><span class="line">        [&quot;parts&quot;]=&gt;</span><br><span class="line">        array(1) &#123;</span><br><span class="line">          [0]=&gt;</span><br><span class="line">          string(6) &quot;assert&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">        array(2) &#123;</span><br><span class="line">          [&quot;startLine&quot;]=&gt;</span><br><span class="line">          int(1)</span><br><span class="line">          [&quot;endLine&quot;]=&gt;</span><br><span class="line">          int(1)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      [&quot;args&quot;]=&gt;</span><br><span class="line">      array(1) &#123;</span><br><span class="line">        [0]=&gt;</span><br><span class="line">        object(PhpParser\Node\Arg)#1182 (5) &#123;</span><br><span class="line">          [&quot;name&quot;]=&gt;</span><br><span class="line">          NULL</span><br><span class="line">          [&quot;value&quot;]=&gt;</span><br><span class="line">          object(PhpParser\Node\Expr\ArrayDimFetch)#1181 (3) &#123;</span><br><span class="line">            [&quot;var&quot;]=&gt;</span><br><span class="line">            object(PhpParser\Node\Expr\Variable)#1179 (2) &#123;</span><br><span class="line">              [&quot;name&quot;]=&gt;</span><br><span class="line">              string(5) &quot;_POST&quot;</span><br><span class="line">              [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">              array(2) &#123;</span><br><span class="line">                [&quot;startLine&quot;]=&gt;</span><br><span class="line">                int(1)</span><br><span class="line">                [&quot;endLine&quot;]=&gt;</span><br><span class="line">                int(1)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            [&quot;dim&quot;]=&gt;</span><br><span class="line">            object(PhpParser\Node\Scalar\String_)#1180 (2) &#123;</span><br><span class="line">              [&quot;value&quot;]=&gt;</span><br><span class="line">              string(5) &quot;shell&quot;</span><br><span class="line">              [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">              array(3) &#123;</span><br><span class="line">                [&quot;startLine&quot;]=&gt;</span><br><span class="line">                int(1)</span><br><span class="line">                [&quot;endLine&quot;]=&gt;</span><br><span class="line">                int(1)</span><br><span class="line">                [&quot;kind&quot;]=&gt;</span><br><span class="line">                int(1)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">            array(2) &#123;</span><br><span class="line">              [&quot;startLine&quot;]=&gt;</span><br><span class="line">              int(1)</span><br><span class="line">              [&quot;endLine&quot;]=&gt;</span><br><span class="line">              int(1)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          [&quot;byRef&quot;]=&gt;</span><br><span class="line">          bool(false)</span><br><span class="line">          [&quot;unpack&quot;]=&gt;</span><br><span class="line">          bool(false)</span><br><span class="line">          [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">          array(2) &#123;</span><br><span class="line">            [&quot;startLine&quot;]=&gt;</span><br><span class="line">            int(1)</span><br><span class="line">            [&quot;endLine&quot;]=&gt;</span><br><span class="line">            int(1)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">      array(2) &#123;</span><br><span class="line">        [&quot;startLine&quot;]=&gt;</span><br><span class="line">        int(1)</span><br><span class="line">        [&quot;endLine&quot;]=&gt;</span><br><span class="line">        int(1)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">    array(2) &#123;</span><br><span class="line">      [&quot;startLine&quot;]=&gt;</span><br><span class="line">      int(1)</span><br><span class="line">      [&quot;endLine&quot;]=&gt;</span><br><span class="line">      int(1)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;attributes&quot;:protected]=&gt;</span><br><span class="line">  array(2) &#123;</span><br><span class="line">    [&quot;startLine&quot;]=&gt;</span><br><span class="line">    int(1)</span><br><span class="line">    [&quot;endLine&quot;]=&gt;</span><br><span class="line">    int(1)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getType()</code>可以返回节点类型，结合访问某个节点，这里想拿到一句话木马里调用的函数名，可以这么写</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print_r(getType(<span class="variable">$ast</span>[<span class="number">0</span>]-&gt;expr-&gt;expr-&gt;name-&gt;parts[<span class="number">0</span>])); <span class="comment">// string 这里返回的类型不带前缀和下划线</span></span><br><span class="line">print_r(<span class="variable">$ast</span>[<span class="number">0</span>]-&gt;expr-&gt;expr-&gt;name-&gt;parts[<span class="number">0</span>]);<span class="comment">// assert</span></span><br></pre></td></tr></table></figure>



<h2 id="Node-traversation"><a href="#Node-traversation" class="headerlink" title="Node traversation"></a>Node traversation</h2><p><code>use PhpParser\NodeTraverser</code></p>
<p>基本用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; PhpParser\Node\Stmt\Expression <span class="keyword">Object</span></span><br><span class="line">        (</span><br><span class="line">            [expr] =&gt; PhpParser\Node\Expr\ErrorSuppress <span class="keyword">Object</span></span><br><span class="line">                (</span><br><span class="line">                    [expr] =&gt; PhpParser\Node\Expr\FuncCall <span class="keyword">Object</span></span><br><span class="line">                        (</span><br><span class="line">                            [name] =&gt; PhpParser\Node\Name <span class="keyword">Object</span></span><br><span class="line">                                (</span><br><span class="line">                                    [parts] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                        (</span><br><span class="line">                                            [<span class="number">0</span>] =&gt; assert</span><br><span class="line">                                        )</span><br><span class="line"></span><br><span class="line">                                    [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                        (</span><br><span class="line">                                            [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                                            [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                                        )</span><br><span class="line"></span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">                            [args] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                (</span><br><span class="line">                                    [<span class="number">0</span>] =&gt; PhpParser\Node\Arg <span class="keyword">Object</span></span><br><span class="line">                                        (</span><br><span class="line">                                            [name] =&gt;</span><br><span class="line">                                            [value] =&gt; PhpParser\Node\Expr\ArrayDimFetch <span class="keyword">Object</span></span><br><span class="line">                                                (</span><br><span class="line">                                                    [<span class="keyword">var</span>] =&gt; PhpParser\Node\Expr\Variable <span class="keyword">Object</span></span><br><span class="line">                                                        (</span><br><span class="line">                                                            [name] =&gt; _POST</span><br><span class="line">                                                            [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                                                (</span><br><span class="line">                                                                    [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                                    [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                                )</span><br><span class="line"></span><br><span class="line">                                                        )</span><br><span class="line"></span><br><span class="line">                                                    [dim] =&gt; PhpParser\Node\Scalar\String_ <span class="keyword">Object</span></span><br><span class="line">                                                        (</span><br><span class="line">                                                            [value] =&gt; shell</span><br><span class="line">                                                            [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                                                (</span><br><span class="line">                                                                    [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                                    [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                                    [kind] =&gt; <span class="number">1</span></span><br><span class="line">                                                                )</span><br><span class="line"></span><br><span class="line">                                                        )</span><br><span class="line"></span><br><span class="line">                                                    [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                                        (</span><br><span class="line">                                                            [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                            [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                        )</span><br><span class="line"></span><br><span class="line">                                                )</span><br><span class="line"></span><br><span class="line">                                            [byRef] =&gt;</span><br><span class="line">                                            [unpack] =&gt;</span><br><span class="line">                                            [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                                (</span><br><span class="line">                                                    [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                    [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                                                )</span><br><span class="line"></span><br><span class="line">                                        )</span><br><span class="line"></span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">                            [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                                (</span><br><span class="line">                                    [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                                    [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                            [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [attributes:<span class="keyword">protected</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [startLine] =&gt; <span class="number">1</span></span><br><span class="line">                    [endLine] =&gt; <span class="number">1</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<p>需要实现<code>PhpParser\NodeVisitor</code>接口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">beforeTraverse</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$nodes</span></span>)</span>; <span class="comment">// 遍历之前调用，可以用于遍历之前重置或准备</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">enterNode</span>(<span class="params">\PhpParser\Node <span class="variable">$node</span></span>)</span>; <span class="comment">// 进入遍历时调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span>	<span class="title">leaveNode</span>(<span class="params">\PhpParser\Node <span class="variable">$node</span></span>)</span>; <span class="comment">// 离开此次遍历时调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">afterTraverse</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$nodes</span></span>)</span>; <span class="comment">// 在遍历之后被调用一次</span></span><br></pre></td></tr></table></figure>






        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
